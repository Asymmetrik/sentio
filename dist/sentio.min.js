/*! sentio Version: 0.1.0 */
function sentio_realtime_timeline(){"use strict";function t(){}function e(){if(c){var t=new Date,i=n(t);h.x.domain([t-o-u,t-o]),h.y.domain(i),m.g.line.select(".line").attr("d",x).attr("transform",null),m.g.xAxis.transition().duration(s.reveal).ease("linear").call(f.x),m.g.yAxis.transition().duration(s.animate).call(f.y),m.g.line.select(".line").transition().duration(s.reveal).ease("linear").attr("transform","translate(-"+h.x(t-o-u+s.reveal)+")").each("end",e)}}function n(t){var e=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];return v.forEach(function(n){var i=g.y(n),r=g.x(n);r<t-o+s.reveal&&(e[0]>i&&(e[0]=i),e[1]<i&&(e[1]=i))}),Number.POSITIVE_INFINITY===e[0]&&Number.NEGATIVE_INFINITY===e[1]&&(e=[0,10]),e[0]>=e[1]&&(e[1]=e[0]+1),e[1]+=.1*(e[1]-e[0]),null!=d&&(null!=d[0]&&(e[0]=d[0]),null!=d[1]&&(e[1]=d[1])),e}var i="rt_timeline_clip_"+Date.now(),r={top:10,right:10,bottom:20,left:40},a=100,l=600,o=1e4,u=6e4,s={reveal:750,animate:300},c=!1,g={x:function(t){return t[0]},y:function(t){return t[1]}},d=[void 0,void 0],h={x:d3.time.scale(),y:d3.scale.linear()},f={x:d3.svg.axis().scale(h.x).orient("bottom"),y:d3.svg.axis().scale(h.y).orient("left").ticks(4)},m={svg:void 0,g:{container:void 0,xAxis:void 0,yAxis:void 0,line:void 0},clipPath:void 0},x=d3.svg.line().interpolate("basis");x.x(function(t,e){return h.x(g.x(t,e))}),x.y(function(t,e){return h.y(g.y(t,e))});var v=[];return t.init=function(e){return m.svg=e.append("svg"),m.clipPath=m.svg.append("defs").append("clipPath").attr("id",i).append("rect"),m.g.container=m.svg.append("g"),m.g.line=m.g.container.append("g").attr("clip-path","url(#"+i+")"),m.g.line.append("path").attr("class","line"),m.g.xAxis=m.g.container.append("g").attr("class","x axis"),m.g.yAxis=m.g.container.append("g").attr("class","y axis"),t},t.data=function(e){return arguments.length?(v=e,m.g.line.datum(v),t):v},t.redraw=function(){Date.now();return h.x.range([0,l-r.left-r.right]),h.y.range([a-r.top-r.bottom,0]),m.clipPath.attr("width",l-r.left-r.right).attr("height",a-r.top-r.bottom),m.svg.attr("width",l).attr("height",a),m.g.xAxis.attr("transform","translate(0,"+h.y.range()[0]+")"),m.g.yAxis.attr("class","y axis"),m.g.container.attr("transform","translate("+r.left+","+r.top+")"),t},t.start=function(){c||(c=!0,e())},t.stop=function(){c&&(c=!1)},t.width=function(e){return arguments.length?(l=e,t):l},t.height=function(e){return arguments.length?(a=e,t):a},t.xAxis=function(e){return arguments.length?(f.x=e,t):f.x},t.yAxis=function(e){return arguments.length?(f.y=e,t):f.y},t.xScale=function(e){return arguments.length?(h.x=e,f.x.scale(e),t):h.x},t.yScale=function(e){return arguments.length?(h.y=e,f.y.scale(e),t):h.y},t.xValue=function(e){return arguments.length?(g.x=e,t):g.x},t.yValue=function(e){return arguments.length?(g.y=e,t):g.y},t.interval=function(e){return arguments.length?(u=e,t):u},t.delay=function(e){return arguments.length?(o=e,t):o},t.yExtent=function(e){return arguments.length?(d=e,t):d},t.duration=function(e){return arguments.length?(s=e,t):s},t}var sentio={},sentio_realtime=sentio.realtime={};sentio.realtime.timeline=sentio_realtime_timeline,angular.module("sentio.realtime",[]),angular.module("sentio.realtime").directive("rtTimeline",function(t,e,n){"use strict";return{restrict:"A",scope:{model:"=",interval:"=",delay:"=",yExtent:"=",duration:"=",resizeWidth:"@",resizeHeight:"@"},replace:!1,link:function(i,r,a){var l=d3.select(r[0]),o=sentio.realtime.timeline();o.init(l),i.$watchCollection("model",function(t,e){(null!=e||null!=t)&&(o.data(t).redraw(),o.start())}),i.$watch("interval",function(t,e){(null!=e||null!=t)&&o.interval(t).redraw()}),i.$watch("delay",function(t,e){(null!=e||null!=t)&&o.delay(t).redraw()}),i.$watch("yExtent",function(t,e){(null!=e||null!=t)&&o.yExtent(t).redraw()}),i.$watch("duration",function(t,e){(null!=e||null!=t)&&o.duration(t)});var u,s=null!=a.resizeWidth,c=null!=a.resizeHeight,g=angular.element(e),d=function(){var e=t[0].body,n=e.style.overflow;e.style.overflow="hidden";var i=r[0],l=i.attributes.width|i.style.width|i.clientWidth,u=i.attributes.height|i.style.height|i.clientHeight,g=s?l-a.resizeWidth:void 0,d=c?u-a.resizeHeight:void 0;e.style.overflow=n,console.log("resize rt.timeline height: "+d+" width: "+g),s&&o.width(g),c&&o.height(d),o.redraw()},h=function(){void 0!==u&&n.cancel(u),u=n(d,200)};(s||c)&&(g.on("resize",h),h()),i.$on("$destroy",function(){g.off("resize",h)})}}});