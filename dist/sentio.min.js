/*! sentio Version: 0.1.0 */
function sentio_realtime_timeline(){"use strict";function t(){}function n(){if(c){var t=new Date,r=e(t);m.x.domain([t-u-o,t-u]),m.y.domain(r),f.g.line.select(".line").attr("d",h).attr("transform",null),f.g.xAxis.transition().duration(s.reveal).ease("linear").call(x.x),f.g.yAxis.transition().duration(s.animate).call(x.y),f.g.line.select(".line").transition().duration(s.reveal).ease("linear").attr("transform","translate(-"+m.x(t-u-o+s.reveal)+")").each("end",n)}}function e(t){var n=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];return y.forEach(function(e){var r=g.y(e),a=g.x(e);a<t-u+s.reveal&&(n[0]>r&&(n[0]=r),n[1]<r&&(n[1]=r))}),Number.POSITIVE_INFINITY===n[0]&&Number.NEGATIVE_INFINITY===n[1]&&(n=[0,10]),n[0]>=n[1]&&(n[1]=n[0]+1),n[1]+=.1*(n[1]-n[0]),null!=d&&(null!=d[0]&&(n[0]=d[0]),null!=d[1]&&(n[1]=d[1])),n}var r="rt_timeline_clip_"+Date.now(),a={top:10,right:10,bottom:20,left:40},i=100,l=600,u=1e4,o=6e4,s={reveal:750,animate:300},c=!1,g={x:function(t){return t[0]},y:function(t){return t[1]}},d=[void 0,void 0],m={x:d3.time.scale(),y:d3.scale.linear()},x={x:d3.svg.axis().scale(m.x).orient("bottom"),y:d3.svg.axis().scale(m.y).orient("left")},f={svg:void 0,g:{container:void 0,xAxis:void 0,yAxis:void 0,line:void 0},clipPath:void 0},h=d3.svg.line();h.x(function(t,n){return m.x(g.x(t,n))}),h.y(function(t,n){return m.y(g.y(t,n))});var y=[];return t.init=function(n){return f.svg=n.append("svg"),f.clipPath=f.svg.append("defs").append("clipPath").attr("id",r).append("rect"),f.g.container=f.svg.append("g"),f.g.line=f.g.container.append("g").attr("clip-path","url(#"+r+")"),f.g.line.append("path").attr("class","line"),f.g.xAxis=f.g.container.append("g").attr("class","x axis"),f.g.yAxis=f.g.container.append("g").attr("class","y axis"),t},t.data=function(n){return arguments.length?(y=n,f.g.line.datum(y),t):y},t.redraw=function(){Date.now();return m.x.range([0,l-a.left-a.right]),m.y.range([i-a.top-a.bottom,0]),f.clipPath.attr("width",l-a.left-a.right).attr("height",i-a.top-a.bottom),f.svg.attr("width",l).attr("height",i),f.g.xAxis.attr("transform","translate(0,"+m.y.range()[0]+")"),f.g.yAxis.attr("class","y axis"),f.g.container.attr("transform","translate("+a.left+","+a.top+")"),t},t.start=function(){c||(c=!0,n())},t.stop=function(){c&&(c=!1)},t.width=function(n){return arguments.length?(l=n,t):l},t.height=function(n){return arguments.length?(i=n,t):i},t.xAxis=function(n){return arguments.length?(x.x=n,t):x.x},t.yAxis=function(n){return arguments.length?(x.y=n,t):x.y},t.xScale=function(n){return arguments.length?(m.x=n,x.x.scale(n),t):m.x},t.yScale=function(n){return arguments.length?(m.y=n,x.y.scale(n),t):m.y},t.xValue=function(n){return arguments.length?(g.x=n,t):g.x},t.yValue=function(n){return arguments.length?(g.y=n,t):g.y},t.interval=function(n){return arguments.length?(o=n,t):o},t.delay=function(n){return arguments.length?(u=n,t):u},t.yExtent=function(n){return arguments.length?(d=n,t):d},t.duration=function(n){return arguments.length?(s=n,t):s},t}var sentio={},sentio_realtime=sentio.realtime={};sentio.realtime.timeline=sentio_realtime_timeline,angular.module("sentio.realtime",[]),angular.module("sentio.realtime").directive("rtTimeline",function(){"use strict";return{restrict:"A",scope:{model:"=",interval:"=",delay:"=",yExtent:"=",duration:"="},replace:!1,link:function(t,n){var e=d3.select(n[0]),r=sentio.realtime.timeline();r.init(e),t.$watchCollection("model",function(t,n){(null!=n||null!=t)&&(r.data(t).redraw(),r.start())}),t.$watch("interval",function(t,n){(null!=n||null!=t)&&r.interval(t).redraw()}),t.$watch("delay",function(t,n){(null!=n||null!=t)&&r.delay(t).redraw()}),t.$watch("yExtent",function(t,n){(null!=n||null!=t)&&r.yExtent(t).redraw()}),t.$watch("duration",function(t,n){(null!=n||null!=t)&&r.duration(t)})}}});